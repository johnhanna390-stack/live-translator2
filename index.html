<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Live Speech → Text + Translation (MyMemory)</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 18px; background: #f4f4f4; }
    .controls { display:flex; gap:10px; align-items:center; margin-bottom:12px; }
    select, button { padding:10px 12px; font-size:15px; border-radius:6px; border:none; }
    button { background:#007bff; color:white; cursor:pointer; }
    button:disabled { background:#bbb; cursor:default; }
    #transcript, #translation {
      margin-top: 14px; padding: 14px; background: white; border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.08); font-size: 18px; white-space: pre-wrap; min-height:48px;
    }
    label { font-size:14px; color:#333; }
    footer { margin-top:18px; color:#666; font-size:13px; }
  </style>
</head>
<body>

<h1>Live Speech → Text + Translation (MyMemory)</h1>

<div class="controls">
  <label for="langSelect">Input language:</label>
  <select id="langSelect" aria-label="Select input language">
    <option value="en-US">English</option>
    <option value="es-ES">Spanish</option>
    <option value="fr-FR">French</option>
    <option value="it-IT">Italian</option>
    <option value="ar-SA">Arabic (Modern Standard)</option>
  </select>

  <button id="startBtn">Start</button>
  <button id="stopBtn" disabled>Stop</button>
  <button id="saveBtn">Save Transcript</button>
</div>

<h2>Detected Speech</h2>
<div id="transcript">Press Start and speak.</div>

<h2>English Translation</h2>
<div id="translation">Translations appear here.</div>

<footer>Works best in Chrome. Translation uses MyMemory (free, no key, reliable for short phrases). Arabic translation may be less accurate.</footer>

<script>
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const saveBtn = document.getElementById('saveBtn');
const langSelect = document.getElementById('langSelect');
const transcriptDiv = document.getElementById('transcript');
const translationDiv = document.getElementById('translation');

let recognition = null;
let fullText = '';
let fullTranslation = '';

// MyMemory translation function
async function translateMyMemory(text, lang) {
  if (!text) return '';
  // Skip translation if English
  if (lang.startsWith('en')) return text;
  try {
    const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${lang.split('-')[0]}|en`;
    const res = await fetch(url);
    if (!res.ok) return '(translation error)';
    const data = await res.json();
    return data.responseData?.translatedText || '(no translation)';
  } catch (err) {
    console.error('Translation error', err);
    return '(translation error)';
  }
}

// Setup SpeechRecognition
function createRecognition(lang) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRecognition) {
    alert('SpeechRecognition not supported in this browser. Use Chrome/Edge.');
    return null;
  }

  const r = new SpeechRecognition();
  r.continuous = true;
  r.interimResults = true;
  r.lang = lang;

  r.onresult = async (event) => {
    let interim = '';
    let final = '';
    for (let i = event.resultIndex; i < event.results.length; i++) {
      const part = event.results[i][0].transcript;
      if (event.results[i].isFinal) final += part + ' ';
      else interim += part;
    }

    const visible = ((fullText ? fullText + ' ' : '') + final + interim).trim();
    transcriptDiv.textContent = visible;

    if (final.trim()) {
      const finalized = final.trim();
      fullText = (fullText ? fullText + ' ' : '') + finalized;
      const translated = await translateMyMemory(finalized, langSelect.value);
      fullTranslation = (fullTranslation ? fullTranslation + ' ' : '') + translated;
      translationDiv.textContent = fullTranslation;
    }
  };

  r.onerror = (ev) => console.warn('Speech error', ev);
  r.onend = () => {
    startBtn.disabled = false;
    stopBtn.disabled = true;
  };

  return r;
}

function startRecognition() {
  recognition = createRecognition(langSelect.value);
  if (!recognition) return;
  recognition.start();
  startBtn.disabled = true;
  stopBtn.disabled = false;
  transcriptDiv.textContent = '';
  translationDiv.textContent = '';
  fullText = '';
  fullTranslation = '';
}

function stopRecognition() {
  if (recognition) recognition.stop();
  startBtn.disabled = false;
  stopBtn.disabled = true;
}

startBtn.onclick = startRecognition;
stopBtn.onclick = stopRecognition;

saveBtn.onclick = () => {
  const out = 'Detected Speech:\n' + fullText + '\n\nEnglish Translation:\n' + fullTranslation;
  const blob = new Blob([out], { type: 'text/plain' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'transcript.txt';
  a.click();
  URL.revokeObjectURL(a.href);
};
</script>

</body>
</html>
